<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Statistics - TMS</title>
    <link rel="stylesheet" href="style.css"> 
    <link rel="icon" href="/img/icon.png" type="image/x-icon">
    <meta name="description" content="Lista completa de pacotes de texturas e o ranking dos 5 principais criadores do site.">
    
    <style>
        /* CSS Specific to the Layout */
        #main-content {
            width: 100%;
            max-width: 1000px;
            padding: 0 10px;
            box-sizing: border-box;
            margin: 0 auto; 
            padding-top: 20px;
            padding-bottom: 100px;
        }
        
        /* Estilo base para os cards de conteúdo */
        .content-card {
            background-color: #111;
            color: #fff;
            border-radius: 15px;
            border: 2px solid #ffffff;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.5);
            padding: 30px; 
            margin: 30px auto;
            max-width: 800px;
            text-align: left;
        }

        .content-card h2 {
            font-size: 36px;
            color: #00aaff;
            margin-top: 0;
            margin-bottom: 30px;
            filter: drop-shadow(0 0 8px #00aaffaa);
        }

        /* ------------------- STYLES FOR PACKS AND CREATORS LISTS ------------------- */
        
        .all-packs-list, .creators-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        
        /* Styles for ALL PACKS list */
        .pack-list li {
            padding: 8px 0;
            border-bottom: 1px solid #222;
        }

        .pack-list li:last-child {
            border-bottom: none;
        }

        .pack-list li a {
            color: #ccc;
            text-decoration: none;
            display: block;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s, color 0.2s;
        }

        /* Estilo específico para packs FEATURED */
        #featured-container .pack-list li a {
            color: #FFD700; /* Dourado */
        }
        
        /* Estilo específico para packs STANDARD */
        #standard-container .pack-list li a {
            color: #ccc; 
        }

        .pack-list li a:hover {
            color: #fff;
            background-color: #00aaff33;
        }

        /* Styles for TOP CREATORS list (mantido do último request) */
        .creator-entry {
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 15px;
            transition: background-color 0.3s;
        }
        
        .creator-entry:hover {
            background-color: #252525;
        }
        
        .creator-entry h3 {
            margin: 0 0 10px 0;
            color: #ffaa00;
            font-size: 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .creator-entry .pack-count {
            font-size: 16px;
            color: #111;
            background-color: #00aaff;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .creator-entry ul {
            list-style: disc;
            margin: 10px 0 0 20px;
            padding: 0;
            font-size: 14px;
        }

        .creator-entry ul li {
            padding: 4px 0;
        }

        .creator-entry ul li a {
            color: #fff;
            text-decoration: none;
            transition: color 0.2s;
        }

        .creator-entry ul li a:hover {
            color: #00aaff;
            text-decoration: underline;
        }
        
        @media (max-width: 600px) {
            .content-card {
                padding: 20px 15px;
            }
            .content-card h2 {
                font-size: 30px;
                margin-bottom: 20px;
            }
        }
    
        /* Summary cards and charts */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: linear-gradient(180deg,#0f1112,#141617);
            border: 1px solid #222;
            border-radius: 10px;
            padding: 16px;
            text-align: center;
        }

        .summary-card h3 { margin: 0; font-size: 20px; color: #ccc }
        .summary-card p { margin: 8px 0 0 0; font-size: 22px; color: #fff; font-weight: 700 }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .charts-grid { grid-template-columns: 1fr }
        }
    </style>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <a href="index.html"><img src="/img/title.png" alt="title" class="title"></a>

    <div id="main-content">

        <div class="content-card">
            <h2>Overview</h2>
            <div class="summary-grid" id="summary-grid">
                <div class="summary-card">
                    <h3>Total Packs</h3>
                    <p id="total-packs">—</p>
                </div>
                <div class="summary-card">
                    <h3>Featured</h3>
                    <p id="total-featured">—</p>
                </div>
                <div class="summary-card">
                    <h3>Texture Packs</h3>
                    <p id="total-texturepacks">—</p>
                </div>
                <div class="summary-card">
                    <h3>Icons</h3>
                    <p id="total-icons">—</p>
                </div>
                <div class="summary-card">
                    <h3>Unique Creators</h3>
                    <p id="total-creators">—</p>
                </div>
                <div class="summary-card">
                    <h3>Resolutions Seen</h3>
                    <p id="total-resolutions">—</p>
                </div>
            </div>
            <p style="margin-top:12px;color:#ccc">This overview shows metrics built from <strong>data/data.json</strong>. Missing fields are handled gracefully.</p>
        </div>

        <div class="content-card">
            <h2>Charts</h2>
            <div class="charts-grid">
                <div>
                    <canvas id="chartTypes" aria-label="Type distribution" role="img"></canvas>
                </div>
                <div>
                    <canvas id="chartResolutions" aria-label="Resolution distribution" role="img"></canvas>
                </div>
                <div>
                    <canvas id="chartCreators" aria-label="Top creators by texture packs" role="img"></canvas>
                </div>
            </div>
        </div>

        <div class="content-card">
            <h2>Top 10 Creators</h2>
            <div id="top-creators-container">
                <p>Loading creators...</p>
            </div>
        </div>

        <div class="content-card">
            <h2>Recent Packs</h2>
            <div id="recent-packs-container">
                <p>Loading recent packs...</p>
            </div>
        </div>

        <div class="content-card">
            <h2>All Packs</h2>
            <div id="all-packs-container">
                <p>Loading all packs...</p>
            </div>
        </div>

    </div>
    
    <footer class="site-footer" role="contentinfo">
        <div class="footer-inner">
            <a class="social-btn youtube" href="https://www.youtube.com/@ChessDash543" target="_blank" rel="noopener" aria-label="YouTube">
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false"><path fill="#FF0000" d="M23.5 6.2a3.0 3.0 0 0 0-2.1-2.1C19.6 3.5 12 3.5 12 3.5s-7.6 0-9.4.6A3.0 3.0 0 0 0 .5 6.2 29.3 29.3 0 0 0 0 12a29.3 29.3 0 0 0 .5 5.8 3.0 3.0 0 0 0 2.1 2.1c1.8.6 9.4.6 9.4.6s7.6 0 9.4-.6a3.0 3.0 0 0 0 2.1-2.1A29.3 29.3 0 0 0 24 12a29.3 29.3 0 0 0-.5-5.8z"></path><path fill="#fff" d="M9.8 15.5V8.5l6.2 3.5-6.2 3.5z"></path></svg>
                <span class="social-label">YouTube</span>
            </a>

            <a class="social-btn discord" href="https://discord.gg/YMGPn26WMN" target="_blank" rel="noopener" aria-label="Discord">
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false"><path fill="#7289DA" d="M20.317 4.369a19.791 19.791 0 0 0-4.885-1.515.07.07 0 0 0-.075.037c-.211.375-.445.864-.608 1.249-1.84-.276-3.68-.276-5.486 0-.163-.39-.405-.88-.617-1.255a.07.07 0 0 0-.076-.036A19.736 19.736 0 0 0 3.678 4.37a.064.064 0 0 0-.03.024C.533 9.045-.319 13.46.066 17.8a.082.082 0 0 0 .031.056 19.9 19.9 0 0 0 6.058 3.08.07.07 0 0 0 .078-.027c.468-.637.885-1.31 1.24-2.01a.07.07 0 0 0-.038-.099 13.35 13.35 0 0 1-1.9-.9.07.07 0 0 1-.007-.12c.127-.096.254-.197.375-.305a.07.07 0 0 1 .073-.01c3.97 1.79 8.27 1.79 12.11 0a.07.07 0 0 1 .076.01c.12.108.247.209.374.305a.07.07 0 0 1-.006.12c-.646.4-1.317.754-1.9.899a.07.07 0 0 0-.038.1c.36.7.777 1.374 1.245 2.01a.07.07 0 0 0 .078.026 19.907 19.907 0 0 0 6.058-3.08.082.082 0 0 0 .031-.056c.5-7.168-2.9-11.561-3.93-12.467a.062.062 0 0 0-.03-.023z"></path><path fill="#fff" d="M8.02 13.577c-1.18 0-2.14-1.085-2.14-2.423 0-1.337.955-2.423 2.14-2.423 1.2 0 2.164 1.086 2.14 2.423 0 1.338-.955 2.423-2.14 2.423zm7.96 0c-1.18 0-2.14-1.085-2.14-2.423 0-1.337.955-2.423 2.14-2.423 1.2 0 2.165 1.086 2.14 2.423 0 1.338-.94 2.423-2.14 2.423z"></path></svg>
                <span class="social-label">Discord</span>
            </a>

            <a class="social-btn github" href="https://github.com/Chessdash543/texture-server" target="_blank" rel="noopener" aria-label="GitHub">
                <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false"><path fill="#fff" d="M12 .5C5.73.5.5 5.74.5 12.02c0 5.1 3.29 9.42 7.86 10.95.58.11.79-.25.79-.56 0-.28-.01-1.02-.02-2-3.2.7-3.88-1.54-3.88-1.54-.52-1.33-1.27-1.69-1.27-1.69-1.04-.71.08-.7.08-.7 1.16.08 1.77 1.2 1.77 1.2 1.02 1.75 2.68 1.24 3.33.95.1-.74.4-1.24.73-1.53-2.55-.29-5.23-1.28-5.23-5.69 0-1.26.45-2.29 1.2-3.1-.12-.3-.52-1.51.11-3.15 0 0 .98-.31 3.2 1.18a11.05 11.05 0 0 1 2.92-.39c.99 0 1.99.13 2.92.39 2.22-1.49 3.2-1.18 3.2-1.18.63 1.64.23 2.85.11 3.15.75.81 1.2 1.84 1.2 3.1 0 4.42-2.69 5.39-5.25 5.67.41.36.77 1.07.77 2.15 0 1.55-.01 2.8-.01 3.18 0 .31.21.68.8.56A10.52 10.52 0 0 0 23.5 12c0-6.28-5.23-11.5-11.5-11.5z"/></svg>
                <span class="social-label">GitHub</span>
            </a>
        </div>
    </footer>


    <script>
        (function(){
            const summary = {
                totalPacks: 0,
                featured: 0,
                types: {},
                resolutions: {},
                creatorsMap: {}
            };

            const el = id => document.getElementById(id);

            function safeNormalizeType(t){
                if (!t && t !== 0) return null;
                return String(t).toLowerCase().trim();
            }

            function addCount(map, key){
                if (!key) return;
                map[key] = (map[key] || 0) + 1;
            }

            function processPacks(packs){
                summary.totalPacks = packs.length;

                packs.forEach(pack => {
                    // featured
                    if (pack.featured === true || String(pack.featured).toLowerCase() === 'true') summary.featured++;

                    // types (pack.type may be array or string)
                    if (Array.isArray(pack.type)){
                        pack.type.forEach(t => addCount(summary.types, safeNormalizeType(t)));
                    } else if (typeof pack.type === 'string'){
                        addCount(summary.types, safeNormalizeType(pack.type));
                    }

                    // resolution (array expected)
                    if (Array.isArray(pack.resolution)){
                        pack.resolution.forEach(r => addCount(summary.resolutions, String(r).toLowerCase()));
                    } else if (pack.resolution){
                        addCount(summary.resolutions, String(pack.resolution).toLowerCase());
                    }

                    // creators
                    const creators = Array.isArray(pack.creators) ? pack.creators : (pack.creator ? [pack.creator] : ['UNKNOWN']);
                    creators.forEach(c => {
                        const key = String(c).trim();
                        if (!key) return;
                        const upper = key.toUpperCase();
                        if (!summary.creatorsMap[upper]) summary.creatorsMap[upper] = { name: key, count: 0, countTexture: 0, packs: [] };
                        summary.creatorsMap[upper].count++;
                        summary.creatorsMap[upper].packs.push({ id: pack.id, name: pack.name, version: pack.version });

                        // If this pack is a texture-pack (type includes 'texture-pack'), increment texture-only counter
                        let isTexturePack = false;
                        if (Array.isArray(pack.type)) {
                            isTexturePack = pack.type.map(t => String(t).toLowerCase()).includes('texture-pack');
                        } else if (typeof pack.type === 'string') {
                            isTexturePack = String(pack.type).toLowerCase() === 'texture-pack';
                        }
                        if (isTexturePack) summary.creatorsMap[upper].countTexture++;
                    });
                });
            }

            function updateSummaryDom(){
                el('total-packs').textContent = summary.totalPacks;
                el('total-featured').textContent = summary.featured;
                el('total-texturepacks').textContent = summary.types['texture-pack'] || 0;
                el('total-icons').textContent = summary.types['icons'] || 0;
                el('total-creators').textContent = Object.keys(summary.creatorsMap).length;
                el('total-resolutions').textContent = Object.keys(summary.resolutions).length;
            }

            function renderTopCreatorsList(){
                const container = el('top-creators-container');
                const creators = Object.values(summary.creatorsMap).sort((a,b)=>b.count-a.count || a.name.localeCompare(b.name));
                if (creators.length === 0){ container.innerHTML = '<p>No creators found.</p>'; return; }
                const top = creators.slice(0,10);
                let html = '<ul class="creators-list">';
                top.forEach((c, idx)=>{
                    html += `<li class="creator-entry"><h3>#${idx+1} ${c.name} <span class="pack-count">${c.count} packs</span></h3>`;
                    html += '<ul>' + c.packs.slice(0,8).map(p=>`<li><a href="pack-detail.html?id=${p.id}">${p.name} (${p.version})</a></li>`).join('') + '</ul>';
                    html += '</li>';
                });
                html += '</ul>';
                container.innerHTML = html;
            }

            function renderRecentPacks(packs){
                const cont = el('recent-packs-container');
                if (!packs || packs.length === 0){ cont.innerHTML = '<p>No packs available.</p>'; return; }
                // assume input order roughly chronological — show last 10
                const recent = packs.slice(-10).reverse();
                cont.innerHTML = '<ul class="pack-list">' + recent.map(p=>`<li><a href="pack-detail.html?id=${p.id}">${p.name} — ${p.version} — ${Array.isArray(p.type)?p.type.join(', '):p.type}</a></li>`).join('') + '</ul>';
            }

            function renderAllPacks(packs){
                const cont = el('all-packs-container');
                if (!packs || packs.length === 0){ cont.innerHTML = '<p>No packs.</p>'; return; }
                const listHtml = packs.map(p=>`<li>${p.name} — ${p.version} — ${(Array.isArray(p.type)?p.type.join(', '):p.type) || '—'} — ${Array.isArray(p.creators)?p.creators.join(', '):p.creator || '—'}</li>`).join('');
                cont.innerHTML = `<ul class="pack-list">${listHtml}</ul>`;
            }

            function createCharts(){
                // Types pie
                const typesLabels = Object.keys(summary.types).filter(k=>k);
                const typesData = typesLabels.map(k=>summary.types[k]);
                const ctxTypes = document.getElementById('chartTypes').getContext('2d');
                new Chart(ctxTypes, {
                    type: 'pie',
                    data: { labels: typesLabels, datasets: [{ data: typesData, backgroundColor: ['#00aaff','#ffaa00','#ff6b6b','#7bd389'] }] },
                    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
                });

                // Resolutions bar
                const resLabels = Object.keys(summary.resolutions).filter(k=>k);
                const resData = resLabels.map(k=>summary.resolutions[k]);
                const ctxRes = document.getElementById('chartResolutions').getContext('2d');
                new Chart(ctxRes, {
                    type: 'bar',
                    data: { labels: resLabels.map(l=>l.toUpperCase()), datasets: [{ label: 'Packs', data: resData, backgroundColor: '#00aaff' }] },
                    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero:true } } }
                });
            }

            async function init(){
                try {
                    const res = await fetch('data/data.json');
                    if (!res.ok) throw new Error('Failed to fetch data/data.json');
                    const packs = await res.json();

                    processPacks(packs);
                    updateSummaryDom();
                    renderTopCreatorsList();
                    renderRecentPacks(packs);
                    renderAllPacks(packs);
                    createCharts();
                } catch (err){
                    console.error(err);
                    document.getElementById('main-content').innerHTML = `<div class="content-card"><h2>Error</h2><p>Não foi possível carregar estatísticas. Verifique o console.</p></div>`;
                }
            }

            init();
        })();
    </script>
</body>
</html>